Partial Update（宽表拼接）
更新时间：2025-08-05 09:47:23
产品详情
我的收藏
本文将为您介绍Partial Update的使用。

为什么需要Partial Update实现大宽表拼接
在传统流式数据管道中，为构建宽表常需在主键上 Join 多个流或表。例如，在实时推荐系统中，为了获得用户 360° 视图，往往需要整合来自偏好、购买、点击、购物车等多个不同数据源的更新。

虽然 Apache Flink 可实现多流 Join，但在大规模场景下存在多个痛点：

状态规模庞大 ：需缓存所有事件直到完成 Join，状态可能长期甚至无限保留；

性能瓶颈 ：检查点开销大、易引发反压，影响整体吞吐和稳定性；

调试困难 ：状态复杂且不可见，问题排查成本高；

数据一致性差 ：TTL 设置可能导致事件提前被丢弃，造成结果错误。

因此，我们迫切的需要一种新的数据打宽方法，避免复杂 Join，并显著降低资源消耗和维护复杂度。

基于Fluss Partial Update的数据打宽新模式
Fluss 引入基于Partial Update（部分更新）机制的数据打宽方法，支持在流处理作业中直接扩展维度信息，无需依赖复杂的多流 Join。

与传统方式不同，Fluss允许各数据源根据主键独立更新自己相关的字段到同一张宽表中。例如，你可以定义一张以user_id为主键的user_profile表，包含所有可能字段。每个数据流只需写入自己知道的部分字段，Fluss 存储引擎会自动按主键合并这些更新。

![alt text](image.png)
其底层机制是：当某条部分更新到达时，Fluss 会查找该主键已有的记录，并仅更新本次提供的字段，其余字段保持不变。合并后的新版本实时落盘，确保每条记录始终是最新的完整状态，其底层机制类似于数据库中的“增量更新”，每次只更新有变化的字段，而非整条记录。这种方式大幅降低了 Flink 作业的状态压力和计算复杂度，使数据管道更轻量、高效、易维护。